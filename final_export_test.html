<!DOCTYPE html>
<html>
<head>
    <title>Final Manifest Export Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- Include the updated manifest scripts -->
    <script src="manifest_scripts.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; background: #f9f9f9; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Final Manifest Export Test</h1>
    <p>This test validates that the manifest export generates Excel files with actual data values, not just template structure.</p>
    
    <div class="test-section info">
        <h2>Test Instructions</h2>
        <ol>
            <li>Click "Test Package 12" button to test Haji package export</li>
            <li>Click "Test Package 5" button to test Umroh package export</li>
            <li>Check that Excel files download with actual jamaah data</li>
            <li>Verify data values appear in the exported spreadsheet</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h2>Package 12: Haji Signature 2026 (3 jamaah)</h2>
        <button onclick="testManifestExport(12)" style="background: #28a745; color: white; border: none;">
            Test Export Package 12
        </button>
        <div id="status12"></div>
    </div>
    
    <div class="test-section">
        <h2>Package 5: UMRAH AGUSTUS SAFAR MUBARAK GOLD (2 jamaah)</h2>
        <button onclick="testManifestExport(5)" style="background: #007bff; color: white; border: none;">
            Test Export Package 5
        </button>
        <div id="status5"></div>
    </div>
    
    <div class="test-section success">
        <h2>What to Expect</h2>
        <p>When you click the export buttons:</p>
        <ul>
            <li>An Excel file will be downloaded to your Downloads folder</li>
            <li>The file name will include the package name and date</li>
            <li>The Excel file will contain:</li>
            <ul>
                <li>Header information (Package name, date, hotel details)</li>
                <li>Column headers for all manifest fields</li>
                <li><strong>ACTUAL JAMAAH DATA</strong> (names, NIK, passport info, etc.)</li>
            </ul>
        </ul>
    </div>
    
    <script>
        function testManifestExport(pakId) {
            const statusDiv = document.getElementById('status' + pakId);
            statusDiv.innerHTML = '<p style="color: blue;">‚è≥ Testing export for package ' + pakId + '...</p>';
            
            $.ajax({
                url: 'export_manifest.php',
                type: 'POST',
                data: { pak_id: pakId, export_type: 'manifest' },
                success: function(response) {
                    console.log('Response for package', pakId, ':', response);
                    
                    if (response.success && response.data.manifest && response.data.manifest.length > 0) {
                        statusDiv.innerHTML = '<div style="background: #d4edda; padding: 10px; border-radius: 5px;">' +
                            '<h4 style="color: #155724;">‚úÖ Data Retrieved Successfully</h4>' +
                            '<p><strong>Package:</strong> ' + response.data.package.name + '</p>' +
                            '<p><strong>Type:</strong> ' + response.data.package.type + '</p>' +
                            '<p><strong>Departure:</strong> ' + response.data.package.departure_date + '</p>' +
                            '<p><strong>Jamaah Count:</strong> ' + response.data.manifest.length + '</p>' +
                            '</div>';
                        
                        // Show sample data to prove we have real values
                        const sampleData = response.data.manifest[0];
                        statusDiv.innerHTML += '<h4>Sample Jamaah Data (to verify real values):</h4>';
                        statusDiv.innerHTML += '<pre>' + JSON.stringify(sampleData, null, 2) + '</pre>';
                        
                        // Now use the updated export function
                        statusDiv.innerHTML += '<p style="color: blue;">üìÑ Generating Excel file...</p>';
                        
                        // Call the export function from manifest_scripts.js
                        if (window.exportToExcel) {
                            window.exportToExcel(pakId, 'manifest', response.data);
                            statusDiv.innerHTML += '<div style="background: #d1ecf1; padding: 10px; border-radius: 5px; margin-top: 10px;">' +
                                '<h4 style="color: #0c5460;">üì• Excel Export Complete</h4>' +
                                '<p>Check your Downloads folder for the Excel file.</p>' +
                                '<p>The file should contain <strong>' + response.data.manifest.length + ' jamaah records</strong> with all their data values.</p>' +
                                '</div>';
                        } else {
                            statusDiv.innerHTML += '<p style="color: red;">‚ùå Export function not found. Check console for errors.</p>';
                        }
                        
                    } else {
                        statusDiv.innerHTML = '<p style="color: red;">‚ùå No manifest data found for package ' + pakId + '</p>';
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error for package', pakId, ':', error);
                    statusDiv.innerHTML = '<p style="color: red;">‚ùå Export failed: ' + error + '</p>';
                }
            });
        }
        
        // Test if the functions are loaded
        $(document).ready(function() {
            if (window.exportToExcel) {
                console.log('‚úÖ Export functions loaded successfully');
            } else {
                console.error('‚ùå Export functions not loaded');
            }
        });
    </script>
</body>
</html>
